name: Auto Label Issues

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  add-label:
    runs-on: ubuntu-latest

    steps:
      - name: Parse and add label
        uses: actions/github-script@v7
        with:
          script: |
            const issueBody = context.payload.issue.body || '';

            // Parse the Type field from issue form
            const typeMatch = issueBody.match(/### Type\s*\n\s*([^\n]+)/);

            if (typeMatch) {
              const type = typeMatch[1].trim().toLowerCase();

              if (type === 'extension' || type === 'script') {
                // Add the corresponding label
                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.issue.number,
                  labels: [type]
                });

                console.log(`Added label: ${type}`);
              }
            }
